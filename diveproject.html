<html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8" /><meta http-equiv="Content-Style-Type" content="text/css" /><meta name="generator" content="Aspose.Words for .NET 17.1.0.0" /><title></title></head><body><div><p style="margin-top:0pt; margin-bottom:0pt; font-size:10.5pt"><span style="font-family:'Courier New'">//</span><span style="font-family:'Microsoft JhengHei'">建立</span><span style="font-family:'Courier New'">I/O</span><span style="font-family:'Microsoft JhengHei'">控制器</span><span style="font-family:'Courier New'">，</span><span style="font-family:'Microsoft JhengHei'">用全域方便學生直接網頁測試</span></p><p style="margin-top:0pt; margin-bottom:0pt; font-size:10.5pt"><span style="font-family:'Courier New'">//</span><span style="font-family:'Microsoft JhengHei'">建立</span><span style="font-family:'Courier New'">diveWorld =&gt; controller</span></p><p style="margin-top:0pt; margin-bottom:0pt; font-size:10.5pt"><span style="font-family:'Courier New'">class Scenes {</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:25.2pt; font-size:10.5pt"><span style="font-family:'Courier New'">constructor(cols, rows, map) {</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:50.4pt; font-size:10.5pt"><span style="font-family:'Courier New'">this.cols = Number(cols);</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:50.4pt; font-size:10.5pt"><span style="font-family:'Courier New'">this.rows = Number(rows);</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:50.4pt; font-size:10.5pt"><span style="font-family:'Courier New'">this.map = map;</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:50.4pt; font-size:10.5pt"><span style="font-family:'Courier New'">this.now_cols = 0;</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:50.4pt; font-size:10.5pt"><span style="font-family:'Courier New'">this.now_rows = 0;</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:25.2pt; font-size:10.5pt"><span style="font-family:'Courier New'">}</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:25.2pt; font-size:10.5pt"><span style="font-family:'Courier New'">setMap(map) {</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:50.4pt; font-size:10.5pt"><span style="font-family:'Courier New'">this.map = map</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:25.2pt; font-size:10.5pt"><span style="font-family:'Courier New'">}</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:25.2pt; font-size:10.5pt"><span style="font-family:'Courier New'">getMap() {</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:50.4pt; font-size:10.5pt"><span style="font-family:'Courier New'">return this.map</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:25.2pt; font-size:10.5pt"><span style="font-family:'Courier New'">}</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:25.2pt; font-size:10.5pt"><span style="font-family:'Courier New'">getTile(col, row) {</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:50.4pt; font-size:10.5pt"><span style="font-family:'Courier New'">return this.map[Number(row) * this.cols + Number(col)]</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:25.2pt; font-size:10.5pt"><span style="font-family:'Courier New'">}</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:25.2pt; font-size:10.5pt"><span style="font-family:'Courier New'">getIndex(col, row) {</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:50.4pt; font-size:10.5pt"><span style="font-family:'Courier New'">return Number(row) * this.cols + Number(col)</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:25.2pt; font-size:10.5pt"><span style="font-family:'Courier New'">}</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:25.2pt; font-size:10.5pt"><span style="font-family:'Courier New'">getTileByIndex(i) {</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:50.4pt; font-size:10.5pt"><span style="font-family:'Courier New'">return this.map[i]</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:25.2pt; font-size:10.5pt"><span style="font-family:'Courier New'">}</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:25.2pt; font-size:10.5pt"><span style="font-family:'Courier New'">getNowTile() {</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:50.4pt; font-size:10.5pt"><span style="font-family:'Courier New'">return [this.now_cols, this.now_rows]</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:25.2pt; font-size:10.5pt"><span style="font-family:'Courier New'">}</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:25.2pt; font-size:10.5pt"><span style="font-family:'Courier New'">getIndexByPID(pid) {</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:50.4pt; font-size:10.5pt"><span style="font-family:'Courier New'">return this.map.findIndex((e) =&gt; {</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:75.6pt; font-size:10.5pt"><span style="font-family:'Courier New'">return e == pid</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:50.4pt; font-size:10.5pt"><span style="font-family:'Courier New'">})</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:25.2pt; font-size:10.5pt"><span style="font-family:'Courier New'">}</span></p><p style="margin-top:0pt; margin-bottom:0pt; font-size:10.5pt"><span style="font-family:'Courier New'">}</span></p><p style="margin-top:0pt; margin-bottom:0pt; font-size:10.5pt"><span style="font-family:'Courier New'">class DiveWorld {</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:25.2pt; font-size:10.5pt"><span style="font-family:'Courier New'">constructor(map, preload_json) {</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:50.4pt; font-size:10.5pt"><span style="font-family:'Courier New'">this.app = document.querySelector("#dive-app");</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:50.4pt; font-size:10.5pt"><span style="font-family:'Courier New'">this.loading = document.querySelector(".loading");</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:50.4pt; font-size:10.5pt"><span style="font-family:'Courier New'">this.preload_json = preload_json;</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:50.4pt; font-size:10.5pt"><span style="font-family:'Courier New'">this.isInitial = true;</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:50.4pt; font-size:10.5pt"><span style="font-family:'Courier New'">this.reset = false;</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:50.4pt; font-size:10.5pt"><span style="font-family:'Courier New'">this.linkers = [];</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:50.4pt; font-size:10.5pt"><span style="font-family:'Courier New'">this.cache_pids = [];</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:50.4pt; font-size:10.5pt"><span style="font-family:'Courier New'">this.linker_index = 0;</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:50.4pt; font-size:10.5pt"><span style="font-family:'Courier New'">this.pid = map[0];</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:50.4pt; font-size:10.5pt"><span style="font-family:'Courier New'">this.index = 0;</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:50.4pt; font-size:10.5pt"><span style="font-family:'Courier New'">this.scenes = new Scenes(map_col, map_row, map);</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:50.4pt; font-size:10.5pt"><span style="font-family:'Courier New'">this.outputList = this.initOutput();</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:50.4pt; font-size:10.5pt"><span style="font-family:'Courier New'">this.complete_timer = null;</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:50.4pt; font-size:10.5pt"><span style="font-family:'Courier New'">this.init_timer = null;</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:50.4pt; font-size:10.5pt"><span style="font-family:'Courier New'">this.start_timer = null;</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:50.4pt; font-size:10.5pt"><span style="font-family:'Courier New'">this.input_timer = null;</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:50.4pt; font-size:10.5pt"><span style="font-family:'Courier New'">this.defaultCount = 6;</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:50.4pt; font-size:10.5pt"><span style="font-family:'Courier New'">this.init();</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:25.2pt; font-size:10.5pt"><span style="font-family:'Courier New'">}</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:25.2pt; font-size:10.5pt"><span style="font-family:'Courier New'">/**</span></p><p style="margin-top:0pt; margin-left:50.4pt; margin-bottom:0pt; text-indent:-18.9pt; font-size:10.5pt"><span style="font-family:'Courier New'">*</span><span style="font:7pt 'Times New Roman'">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span style="font-family:'Courier New'">get map data . initial map[0]</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:31.5pt; font-size:10.5pt"><span style="font-family:'Courier New'">*/</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:25.2pt; font-size:10.5pt"><span style="font-family:'Courier New'">init() {</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:50.4pt; font-size:10.5pt"><span style="font-family:'Courier New'">let _world = this;</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:50.4pt; font-size:10.5pt"><span style="font-family:'Courier New'">window.addEventListener("click", triggerFull, false)</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:50.4pt; font-size:10.5pt"><span style="font-family:'Courier New'">this.nextStage();</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:50.4pt; font-size:10.5pt"><span style="font-family:'Courier New'">this.isInitial = false;</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:50.4pt; font-size:10.5pt"><span style="font-family:'Courier New'">this.fullScreen()</span></p><p style="margin-top:0pt; margin-bottom:0pt; font-size:10.5pt"><span style="font-family:'Courier New'">&#xa0;</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:50.4pt; font-size:10.5pt"><span style="font-family:'Courier New'">function triggerFull() {</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:75.6pt; font-size:10.5pt"><span style="font-family:'Courier New'">_world.fullScreen();</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:75.6pt; font-size:10.5pt"><span style="font-family:'Courier New'">_world.hideBlock();</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:75.6pt; font-size:10.5pt"><span style="font-family:'Courier New'">_world.start();</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:75.6pt; font-size:10.5pt"><span style="font-family:'Courier New'">_world.hide();</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:75.6pt; font-size:10.5pt"><span style="font-family:'Courier New'">window.removeEventListener("click", triggerFull, false)</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:50.4pt; font-size:10.5pt"><span style="font-family:'Courier New'">}</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:25.2pt; font-size:10.5pt"><span style="font-family:'Courier New'">}</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:25.2pt; font-size:10.5pt"><span style="font-family:'Courier New'">startPreload() {</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:50.4pt; font-size:10.5pt"><span style="font-family:'Courier New'">let pid = (this.isInitial) ? this.scenes.getTileByIndex(0) : this.pid;</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:50.4pt; font-size:10.5pt"><span style="font-family:'Courier New'">let isCustom = this.checkCustomPreload(pid);</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:50.4pt; font-size:10.5pt"><span style="font-family:'Courier New'">if (this.isInitial) {</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:75.6pt; font-size:10.5pt"><span style="font-family:'Courier New'">// first load map[00]</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:75.6pt; font-size:10.5pt"><span style="font-family:'Courier New'">//TODO should refactory</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:75.6pt; font-size:10.5pt"><span style="font-family:'Courier New'">this.initPreload(1)</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:75.6pt; font-size:10.5pt"><span style="font-family:'Courier New'">let linker = this.getLinker();</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:75.6pt; font-size:10.5pt"><span style="font-family:'Courier New'">linker.setProject(pid);</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:50.4pt; font-size:10.5pt"><span style="font-family:'Courier New'">}</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:50.4pt; font-size:10.5pt"><span style="font-family:'Courier New'">if (isCustom) return this.customPreload(pid)</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:50.4pt; font-size:10.5pt"><span style="font-family:'Courier New'">return this.defaultPreload()</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:25.2pt; font-size:10.5pt"><span style="font-family:'Courier New'">}</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:25.2pt; font-size:10.5pt"><span style="font-family:'Courier New'">customPreload(pid) {</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:50.4pt; font-size:10.5pt"><span style="font-family:'Courier New'">if (this.reset) {</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:75.6pt; font-size:10.5pt"><span style="font-family:'Courier New'">this.initPreload(1);</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:75.6pt; font-size:10.5pt"><span style="font-family:'Courier New'">//jump tile</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:75.6pt; font-size:10.5pt"><span style="font-family:'Courier New'">let linker = this.getLinker();</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:75.6pt; font-size:10.5pt"><span style="font-family:'Courier New'">let scenes = this.scenes;</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:75.6pt; font-size:10.5pt"><span style="font-family:'Courier New'">linker.setProject(scenes.getTileByIndex(this.index));</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:50.4pt; font-size:10.5pt"><span style="font-family:'Courier New'">}</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:50.4pt; font-size:10.5pt"><span style="font-family:'Courier New'">let _world = this;</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:50.4pt; font-size:10.5pt"><span style="font-family:'Courier New'">let preloadArray = this.getPreloadArray(pid);</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:50.4pt; font-size:10.5pt"><span style="font-family:'Courier New'">this.cache_pids = preloadArray;</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:50.4pt; font-size:10.5pt"><span style="font-family:'Courier New'">this.cache_index = preloadArray.map((e) =&gt; {</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:75.6pt; font-size:10.5pt"><span style="font-family:'Courier New'">return _world.scenes.getIndexByPID(e)</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:50.4pt; font-size:10.5pt"><span style="font-family:'Courier New'">});</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:50.4pt; font-size:10.5pt"><span style="font-family:'Courier New'">const l = preloadArray.length;</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:50.4pt; font-size:10.5pt"><span style="font-family:'Courier New'">this.initPrelaods(l + 2);</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:50.4pt; font-size:10.5pt"><span style="font-family:'Courier New'">try {</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:75.6pt; font-size:10.5pt"><span style="font-family:'Courier New'">for (let i = 0; i &lt; l; i++) {</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:100.8pt; font-size:10.5pt"><span style="font-family:'Courier New'">const _pid = preloadArray[i];</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:100.8pt; font-size:10.5pt"><span style="font-family:'Courier New'">console.log("custome prelaod id" + _pid)</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:100.8pt; font-size:10.5pt"><span style="font-family:'Courier New'">const _i = i + 1;</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:100.8pt; font-size:10.5pt"><span style="font-family:'Courier New'">let linker = this.getLinker(_i);</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:100.8pt; font-size:10.5pt"><span style="font-family:'Courier New'">if (linker) {</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:126pt; font-size:10.5pt"><span style="font-family:'Courier New'">linker.setProject(_pid);</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:126pt; font-size:10.5pt"><span style="font-family:'Courier New'">linker.enableBlock(false);</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:100.8pt; font-size:10.5pt"><span style="font-family:'Courier New'">}</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:75.6pt; font-size:10.5pt"><span style="font-family:'Courier New'">}</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:50.4pt; font-size:10.5pt"><span style="font-family:'Courier New'">} catch (error) {</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:75.6pt; font-size:10.5pt"><span style="font-family:'Courier New'">console.log("customPreload error : " + error);</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:50.4pt; font-size:10.5pt"><span style="font-family:'Courier New'">}</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:25.2pt; font-size:10.5pt"><span style="font-family:'Courier New'">}</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:25.2pt; font-size:10.5pt"><span style="font-family:'Courier New'">//init 4 iframe ,2 =&gt; 6</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:25.2pt; font-size:10.5pt"><span style="font-family:'Courier New'">defaultPreload() {</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:50.4pt; font-size:10.5pt"><span style="font-family:'Courier New'">if (this.reset) this.initPreload(1)</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:50.4pt; font-size:10.5pt"><span style="font-family:'Courier New'">this.initPrelaods(this.defaultCount);</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:50.4pt; font-size:10.5pt"><span style="font-family:'Courier New'">let scenes = this.scenes;</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:50.4pt; font-size:10.5pt"><span style="font-family:'Courier New'">let linker = this.getLinker();</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:50.4pt; font-size:10.5pt"><span style="font-family:'Courier New'">if (this.reset) {</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:75.6pt; font-size:10.5pt"><span style="font-family:'Courier New'">//jump tile</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:75.6pt; font-size:10.5pt"><span style="font-family:'Courier New'">linker.setProject(scenes.getTileByIndex(this.index));</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:50.4pt; font-size:10.5pt"><span style="font-family:'Courier New'">}</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:50.4pt; font-size:10.5pt"><span style="font-family:'Courier New'">let preload_array = [</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:75.6pt; font-size:10.5pt"><span style="font-family:'Courier New'">this.index - scenes.cols,</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:75.6pt; font-size:10.5pt"><span style="font-family:'Courier New'">this.index - 1,</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:75.6pt; font-size:10.5pt"><span style="font-family:'Courier New'">this.index + 1,</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:75.6pt; font-size:10.5pt"><span style="font-family:'Courier New'">this.index + scenes.cols</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:50.4pt; font-size:10.5pt"><span style="font-family:'Courier New'">];</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:50.4pt; font-size:10.5pt"><span style="font-family:'Courier New'">this.cache_index = preload_array;</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:50.4pt; font-size:10.5pt"><span style="font-family:'Courier New'">this.cache_pids = preload_array.map((e) =&gt; {</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:75.6pt; font-size:10.5pt"><span style="font-family:'Courier New'">return scenes.getTileByIndex(e)</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:50.4pt; font-size:10.5pt"><span style="font-family:'Courier New'">});</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:50.4pt; font-size:10.5pt"><span style="font-family:'Courier New'">//TODO  fragile</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:50.4pt; font-size:10.5pt"><span style="font-family:'Courier New'">try {</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:75.6pt; font-size:10.5pt"><span style="font-family:'Courier New'">for (let i = 0; i &lt; this.cache_pids.length; i++) {</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:100.8pt; font-size:10.5pt"><span style="font-family:'Courier New'">const pid = this.cache_pids[i];</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:100.8pt; font-size:10.5pt"><span style="font-family:'Courier New'">const _i = i + 1;</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:100.8pt; font-size:10.5pt"><span style="font-family:'Courier New'">let linker = this.getLinker(_i);</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:100.8pt; font-size:10.5pt"><span style="font-family:'Courier New'">if (linker &amp;&amp; pid) {</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:126pt; font-size:10.5pt"><span style="font-family:'Courier New'">linker.setProject(pid);</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:126pt; font-size:10.5pt"><span style="font-family:'Courier New'">linker.enableBlock(false);</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:100.8pt; font-size:10.5pt"><span style="font-family:'Courier New'">}</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:75.6pt; font-size:10.5pt"><span style="font-family:'Courier New'">}</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:50.4pt; font-size:10.5pt"><span style="font-family:'Courier New'">} catch (error) {</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:75.6pt; font-size:10.5pt"><span style="font-family:'Courier New'">console.log("defaultPreload error : " + error);</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:50.4pt; font-size:10.5pt"><span style="font-family:'Courier New'">}</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:25.2pt; font-size:10.5pt"><span style="font-family:'Courier New'">}</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:25.2pt; font-size:10.5pt"><span style="font-family:'Courier New'">checkCustomPreload(eid) {</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:50.4pt; font-size:10.5pt"><span style="font-family:'Courier New'">return this.preload_json[eid]</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:25.2pt; font-size:10.5pt"><span style="font-family:'Courier New'">}</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:25.2pt; font-size:10.5pt"><span style="font-family:'Courier New'">getPreloadArray(eid) {</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:50.4pt; font-size:10.5pt"><span style="font-family:'Courier New'">return this.preload_json[eid]</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:25.2pt; font-size:10.5pt"><span style="font-family:'Courier New'">}</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:25.2pt; font-size:10.5pt"><span style="font-family:'Courier New'">initIframe(i) {</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:50.4pt; font-size:10.5pt"><span style="font-family:'Courier New'">let iframe = document.createElement("iframe");</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:50.4pt; font-size:10.5pt"><span style="font-family:'Courier New'">iframe.className = (i == 1) ? "dive preload" : "dive preload dive-hide";</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:50.4pt; font-size:10.5pt"><span style="font-family:'Courier New'">iframe.setAttribute("name", "dive" + i);</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:50.4pt; font-size:10.5pt"><span style="font-family:'Courier New'">return iframe</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:25.2pt; font-size:10.5pt"><span style="font-family:'Courier New'">}</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:25.2pt; font-size:10.5pt"><span style="font-family:'Courier New'">initLinker(i) {</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:50.4pt; font-size:10.5pt"><span style="font-family:'Courier New'">let option = (this.isInitial) ? {} : {</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:75.6pt; font-size:10.5pt"><span style="font-family:'Courier New'">"watermark": false</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:50.4pt; font-size:10.5pt"><span style="font-family:'Courier New'">};</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:50.4pt; font-size:10.5pt"><span style="font-family:'Courier New'">const linker = new DiveLinker("dive" + i, option)</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:50.4pt; font-size:10.5pt"><span style="font-family:'Courier New'">this.linkers.push(linker);</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:25.2pt; font-size:10.5pt"><span style="font-family:'Courier New'">}</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:25.2pt; font-size:10.5pt"><span style="font-family:'Courier New'">initPrelaods(count) {</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:50.4pt; font-size:10.5pt"><span style="font-family:'Courier New'">for (let i = 2; i &lt; count; i++) {</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:75.6pt; font-size:10.5pt"><span style="font-family:'Courier New'">this.initPreload(i);</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:50.4pt; font-size:10.5pt"><span style="font-family:'Courier New'">}</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:25.2pt; font-size:10.5pt"><span style="font-family:'Courier New'">}</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:25.2pt; font-size:10.5pt"><span style="font-family:'Courier New'">//just append .. refactory by Fragment  when slowly</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:25.2pt; font-size:10.5pt"><span style="font-family:'Courier New'">initPreload(i) {</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:50.4pt; font-size:10.5pt"><span style="font-family:'Courier New'">this.app.appendChild(this.initIframe(i));</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:50.4pt; font-size:10.5pt"><span style="font-family:'Courier New'">this.initLinker(i);</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:25.2pt; font-size:10.5pt"><span style="font-family:'Courier New'">}</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:25.2pt; font-size:10.5pt"><span style="font-family:'Courier New'">bind(func) {</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:50.4pt; font-size:10.5pt"><span style="font-family:'Courier New'">let world = this;</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:50.4pt; font-size:10.5pt"><span style="font-family:'Courier New'">return function () {</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:75.6pt; font-size:10.5pt"><span style="font-family:'Courier New'">return func.apply(world, arguments)</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:50.4pt; font-size:10.5pt"><span style="font-family:'Courier New'">}</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:25.2pt; font-size:10.5pt"><span style="font-family:'Courier New'">}</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:25.2pt; font-size:10.5pt"><span style="font-family:'Courier New'">bindTimer() {</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:50.4pt; font-size:10.5pt"><span style="font-family:'Courier New'">let _world = this;</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:50.4pt; font-size:10.5pt"><span style="font-family:'Courier New'">let linker = _world.getLinker();</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:50.4pt; font-size:10.5pt"><span style="font-family:'Courier New'">_world.checkTimer("complete_timer");</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:50.4pt; font-size:10.5pt"><span style="font-family:'Courier New'">this.reset = false;</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:50.4pt; font-size:10.5pt"><span style="font-family:'Courier New'">_world.complete_timer = setInterval(() =&gt; {</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:75.6pt; font-size:10.5pt"><span style="font-family:'Courier New'">if (!linker.checkComplete()) return</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:75.6pt; font-size:10.5pt"><span style="font-family:'Courier New'">console.warn("go next :" + _world.complete_timer);</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:75.6pt; font-size:10.5pt"><span style="font-family:'Courier New'">clearInterval(_world.complete_timer);</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:75.6pt; font-size:10.5pt"><span style="font-family:'Courier New'">delete _world.complete_timer;</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:75.6pt; font-size:10.5pt"><span style="font-family:'Courier New'">_world.sleep(0.1)</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:100.8pt; font-size:10.5pt"><span style="font-family:'Courier New'">.then(linker.pause())</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:100.8pt; font-size:10.5pt"><span style="font-family:'Courier New'">.then(_world.nextStage())</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:50.4pt; font-size:10.5pt"><span style="font-family:'Courier New'">}, 100);</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:25.2pt; font-size:10.5pt"><span style="font-family:'Courier New'">}</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:25.2pt; font-size:10.5pt"><span style="font-family:'Courier New'">waitInit() {</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:50.4pt; font-size:10.5pt"><span style="font-family:'Courier New'">return new Promise((resolve, reject) =&gt; {</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:75.6pt; font-size:10.5pt"><span style="font-family:'Courier New'">let _world = this;</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:75.6pt; font-size:10.5pt"><span style="font-family:'Courier New'">let linker = _world.getLinker();</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:75.6pt; font-size:10.5pt"><span style="font-family:'Courier New'">_world.checkTimer("init_timer");</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:75.6pt; font-size:10.5pt"><span style="font-family:'Courier New'">_world.init_timer = setInterval(() =&gt; {</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:100.8pt; font-size:10.5pt"><span style="font-family:'Courier New'">if (!linker.initial) return linker.getIOList()</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:100.8pt; font-size:10.5pt"><span style="font-family:'Courier New'">clearInterval(_world.init_timer)</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:100.8pt; font-size:10.5pt"><span style="font-family:'Courier New'">delete _world.init_timer;</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:100.8pt; font-size:10.5pt"><span style="font-family:'Courier New'">resolve()</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:75.6pt; font-size:10.5pt"><span style="font-family:'Courier New'">}, 100);</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:50.4pt; font-size:10.5pt"><span style="font-family:'Courier New'">});</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:25.2pt; font-size:10.5pt"><span style="font-family:'Courier New'">}</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:25.2pt; font-size:10.5pt"><span style="font-family:'Courier New'">checkTimer(timer) {</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:50.4pt; font-size:10.5pt"><span style="font-family:'Courier New'">let _world = this;</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:50.4pt; font-size:10.5pt"><span style="font-family:'Courier New'">if (_world[timer]) {</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:75.6pt; font-size:10.5pt"><span style="font-family:'Courier New'">clearInterval(_world[timer]);</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:75.6pt; font-size:10.5pt"><span style="font-family:'Courier New'">delete _world[timer];</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:50.4pt; font-size:10.5pt"><span style="font-family:'Courier New'">}</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:25.2pt; font-size:10.5pt"><span style="font-family:'Courier New'">}</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:25.2pt; font-size:10.5pt"><span style="font-family:'Courier New'">waitStart() {</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:50.4pt; font-size:10.5pt"><span style="font-family:'Courier New'">return new Promise((resolve, reject) =&gt; {</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:75.6pt; font-size:10.5pt"><span style="font-family:'Courier New'">let _world = this;</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:75.6pt; font-size:10.5pt"><span style="font-family:'Courier New'">let linker = _world.getLinker();</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:75.6pt; font-size:10.5pt"><span style="font-family:'Courier New'">_world.checkTimer("start_timer");</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:75.6pt; font-size:10.5pt"><span style="font-family:'Courier New'">if (this.isInitial) return resolve()</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:75.6pt; font-size:10.5pt"><span style="font-family:'Courier New'">_world.start_timer = setInterval(() =&gt; {</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:100.8pt; font-size:10.5pt"><span style="font-family:'Courier New'">console.warn("wait start");</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:100.8pt; font-size:10.5pt"><span style="font-family:'Courier New'">if (linker.checkDiveStatus() !== "start") return _world.start()</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:100.8pt; font-size:10.5pt"><span style="font-family:'Courier New'">clearInterval(_world.start_timer);</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:100.8pt; font-size:10.5pt"><span style="font-family:'Courier New'">delete _world.start_timer;</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:100.8pt; font-size:10.5pt"><span style="font-family:'Courier New'">resolve()</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:75.6pt; font-size:10.5pt"><span style="font-family:'Courier New'">}, 100);</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:50.4pt; font-size:10.5pt"><span style="font-family:'Courier New'">});</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:25.2pt; font-size:10.5pt"><span style="font-family:'Courier New'">}</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:25.2pt; font-size:10.5pt"><span style="font-family:'Courier New'">update() {</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:50.4pt; font-size:10.5pt"><span style="font-family:'Courier New'">this.updateOutput();</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:50.4pt; font-size:10.5pt"><span style="font-family:'Courier New'">let next_col = Number(this.get_world_output(col));</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:50.4pt; font-size:10.5pt"><span style="font-family:'Courier New'">let next_row = Number(this.get_world_output(row));</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:50.4pt; font-size:10.5pt"><span style="font-family:'Courier New'">this.udpateScenes(next_col, next_row);</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:50.4pt; font-size:10.5pt"><span style="font-family:'Courier New'">this.updateIndex(next_col, next_row);</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:25.2pt; font-size:10.5pt"><span style="font-family:'Courier New'">}</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:25.2pt; font-size:10.5pt"><span style="font-family:'Courier New'">// fix 20190808</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:25.2pt; font-size:10.5pt"><span style="font-family:'Courier New'">nextStage() {</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:50.4pt; font-size:10.5pt"><span style="font-family:'Courier New'">let _world = this;</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:50.4pt; font-size:10.5pt"><span style="font-family:'Courier New'">if (!this.isInitial) this.update()</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:50.4pt; font-size:10.5pt"><span style="font-family:'Courier New'">if (this.isInitial) _world.fullScreen()</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:50.4pt; font-size:10.5pt"><span style="font-family:'Courier New'">this.startPreload();</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:50.4pt; font-size:10.5pt"><span style="font-family:'Courier New'">(async () =&gt; {</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:75.6pt; font-size:10.5pt"><span style="font-family:'Courier New'">await _world.showNext();</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:75.6pt; font-size:10.5pt"><span style="font-family:'Courier New'">await _world.waitInit();</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:75.6pt; font-size:10.5pt"><span style="font-family:'Courier New'">await _world.setInput();</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:75.6pt; font-size:10.5pt"><span style="font-family:'Courier New'">await _world.hideBlock();</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:75.6pt; font-size:10.5pt"><span style="font-family:'Courier New'">await _world.waitStart();</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:75.6pt; font-size:10.5pt"><span style="font-family:'Courier New'">await _world.bindTimer();</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:50.4pt; font-size:10.5pt"><span style="font-family:'Courier New'">})();</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:25.2pt; font-size:10.5pt"><span style="font-family:'Courier New'">}</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:25.2pt; font-size:10.5pt"><span style="font-family:'Courier New'">hideBlock() {</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:50.4pt; font-size:10.5pt"><span style="font-family:'Courier New'">return new Promise((resolve, reject) =&gt; {</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:75.6pt; font-size:10.5pt"><span style="font-family:'Courier New'">if (this.isInitial) return resolve()</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:75.6pt; font-size:10.5pt"><span style="font-family:'Courier New'">let linker = this.getLinker();</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:75.6pt; font-size:10.5pt"><span style="font-family:'Courier New'">linker.enableBlock(false);</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:75.6pt; font-size:10.5pt"><span style="font-family:'Courier New'">resolve();</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:50.4pt; font-size:10.5pt"><span style="font-family:'Courier New'">});</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:25.2pt; font-size:10.5pt"><span style="font-family:'Courier New'">}</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:25.2pt; font-size:10.5pt"><span style="font-family:'Courier New'">start() {</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:50.4pt; font-size:10.5pt"><span style="font-family:'Courier New'">let linker = this.getLinker();</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:50.4pt; font-size:10.5pt"><span style="font-family:'Courier New'">linker.start();</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:50.4pt; font-size:10.5pt"><span style="font-family:'Courier New'">this.focusDIVE();</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:25.2pt; font-size:10.5pt"><span style="font-family:'Courier New'">}</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:25.2pt; font-size:10.5pt"><span style="font-family:'Courier New'">/**</span></p><p style="margin-top:0pt; margin-left:50.4pt; margin-bottom:0pt; text-indent:-18.9pt; font-size:10.5pt"><span style="font-family:'Courier New'">*</span><span style="font:7pt 'Times New Roman'">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span style="font-family:'Courier New'">return by i or nowIndex</span></p><p style="margin-top:0pt; margin-left:50.4pt; margin-bottom:0pt; text-indent:-18.9pt; font-size:10.5pt"><span style="font-family:'Courier New'">*</span><span style="font:7pt 'Times New Roman'">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span style="font-family:'Courier New'">@param {number} i</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:31.5pt; font-size:10.5pt"><span style="font-family:'Courier New'">*/</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:25.2pt; font-size:10.5pt"><span style="font-family:'Courier New'">getLinker(i) {</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:50.4pt; font-size:10.5pt"><span style="font-family:'Courier New'">return (i) ? this.linkers[i] : this.linkers[0]</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:25.2pt; font-size:10.5pt"><span style="font-family:'Courier New'">}</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:25.2pt; font-size:10.5pt"><span style="font-family:'Courier New'">initOutput() {</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:50.4pt; font-size:10.5pt"><span style="font-family:'Courier New'">let result = {};</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:50.4pt; font-size:10.5pt"><span style="font-family:'Courier New'">outputNames.push(row);</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:50.4pt; font-size:10.5pt"><span style="font-family:'Courier New'">outputNames.push(col);</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:50.4pt; font-size:10.5pt"><span style="font-family:'Courier New'">for (let i = 0; i &lt; outputNames.length; i++) {</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:75.6pt; font-size:10.5pt"><span style="font-family:'Courier New'">const output = outputNames[i];</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:75.6pt; font-size:10.5pt"><span style="font-family:'Courier New'">result[output] = {</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:100.8pt; font-size:10.5pt"><span style="font-family:'Courier New'">name: output,</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:100.8pt; font-size:10.5pt"><span style="font-family:'Courier New'">value: 0</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:75.6pt; font-size:10.5pt"><span style="font-family:'Courier New'">}</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:50.4pt; font-size:10.5pt"><span style="font-family:'Courier New'">}</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:50.4pt; font-size:10.5pt"><span style="font-family:'Courier New'">return result</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:25.2pt; font-size:10.5pt"><span style="font-family:'Courier New'">}</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:25.2pt; font-size:10.5pt"><span style="font-family:'Courier New'">sleep(delay) {</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:50.4pt; font-size:10.5pt"><span style="font-family:'Courier New'">return new Promise((resolve, reject) =&gt; {</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:75.6pt; font-size:10.5pt"><span style="font-family:'Courier New'">setTimeout(() =&gt; {</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:100.8pt; font-size:10.5pt"><span style="font-family:'Courier New'">resolve();</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:75.6pt; font-size:10.5pt"><span style="font-family:'Courier New'">}, delay * 800);</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:50.4pt; font-size:10.5pt"><span style="font-family:'Courier New'">});</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:25.2pt; font-size:10.5pt"><span style="font-family:'Courier New'">}</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:25.2pt; font-size:10.5pt"><span style="font-family:'Courier New'">/**</span></p><p style="margin-top:0pt; margin-left:50.4pt; margin-bottom:0pt; text-indent:-18.9pt; font-size:10.5pt"><span style="font-family:'Courier New'">*</span><span style="font:7pt 'Times New Roman'">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span style="font-family:'Courier New'">Useless</span></p><p style="margin-top:0pt; margin-left:50.4pt; margin-bottom:0pt; text-indent:-18.9pt; font-size:10.5pt"><span style="font-family:'Courier New'">*</span><span style="font:7pt 'Times New Roman'">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span style="font-family:'Courier New'">@param {Number} next_col</span></p><p style="margin-top:0pt; margin-left:50.4pt; margin-bottom:0pt; text-indent:-18.9pt; font-size:10.5pt"><span style="font-family:'Courier New'">*</span><span style="font:7pt 'Times New Roman'">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span style="font-family:'Courier New'">@param {Number} next_row</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:31.5pt; font-size:10.5pt"><span style="font-family:'Courier New'">*/</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:25.2pt; font-size:10.5pt"><span style="font-family:'Courier New'">udpateScenes(next_col, next_row) {</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:50.4pt; font-size:10.5pt"><span style="font-family:'Courier New'">this.scenes.now_cols = next_col;</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:50.4pt; font-size:10.5pt"><span style="font-family:'Courier New'">this.scenes.now_rows = next_row;</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:25.2pt; font-size:10.5pt"><span style="font-family:'Courier New'">}</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:25.2pt; font-size:10.5pt"><span style="font-family:'Courier New'">updateOutput() {</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:50.4pt; font-size:10.5pt"><span style="font-family:'Courier New'">let linker = this.getLinker();</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:50.4pt; font-size:10.5pt"><span style="font-family:'Courier New'">let new_outputs = linker.getOutputList();</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:50.4pt; font-size:10.5pt"><span style="font-family:'Courier New'">let keep_outputs = this.get_world_outputs();</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:50.4pt; font-size:10.5pt"><span style="font-family:'Courier New'">for (const key in new_outputs) {</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:75.6pt; font-size:10.5pt"><span style="font-family:'Courier New'">if (new_outputs.hasOwnProperty(key)) {</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:100.8pt; font-size:10.5pt"><span style="font-family:'Courier New'">const output = new_outputs[key];</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:100.8pt; font-size:10.5pt"><span style="font-family:'Courier New'">if (outputNames.indexOf(output.name) == -1) continue</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:100.8pt; font-size:10.5pt"><span style="font-family:'Courier New'">keep_outputs[output.name]["value"] = output.value;</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:75.6pt; font-size:10.5pt"><span style="font-family:'Courier New'">}</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:50.4pt; font-size:10.5pt"><span style="font-family:'Courier New'">}</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:25.2pt; font-size:10.5pt"><span style="font-family:'Courier New'">}</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:25.2pt; font-size:10.5pt"><span style="font-family:'Courier New'">updateIndex(next_col, next_row) {</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:50.4pt; font-size:10.5pt"><span style="font-family:'Courier New'">this.pid = this.scenes.getTile(this.scenes.now_cols, this.scenes.now_rows);</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:50.4pt; font-size:10.5pt"><span style="font-family:'Courier New'">let newIndex = this.scenes.getIndex(this.scenes.now_cols, this.scenes.now_rows);</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:50.4pt; font-size:10.5pt"><span style="font-family:'Courier New'">let _index = this.cache_index.findIndex(function (e) {</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:75.6pt; font-size:10.5pt"><span style="font-family:'Courier New'">return e == newIndex</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:50.4pt; font-size:10.5pt"><span style="font-family:'Courier New'">})</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:50.4pt; font-size:10.5pt"><span style="font-family:'Courier New'">this.linker_index = _index + 1;</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:50.4pt; font-size:10.5pt"><span style="font-family:'Courier New'">this.index = newIndex;</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:50.4pt; font-size:10.5pt"><span style="font-family:'Courier New'">if (_index == -1) {</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:75.6pt; font-size:10.5pt"><span style="font-family:'Courier New'">this.reset = true;</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:50.4pt; font-size:10.5pt"><span style="font-family:'Courier New'">}</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:50.4pt; font-size:10.5pt"><span style="font-family:'Courier New'">this.linkers = this.linkers.filter((e) =&gt; {</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:75.6pt; font-size:10.5pt"><span style="font-family:'Courier New'">return e.getProjectID() == this.pid</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:50.4pt; font-size:10.5pt"><span style="font-family:'Courier New'">})</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:50.4pt; font-size:10.5pt"><span style="font-family:'Courier New'">return this.adjustIframe();</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:25.2pt; font-size:10.5pt"><span style="font-family:'Courier New'">}</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:25.2pt; font-size:10.5pt"><span style="font-family:'Courier New'">//TODO need to drop all . here has bug with chrome =&gt; iframe event</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:25.2pt; font-size:10.5pt"><span style="font-family:'Courier New'">adjustIframe() {</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:50.4pt; font-size:10.5pt"><span style="font-family:'Courier New'">let _world = this;</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:50.4pt; font-size:10.5pt"><span style="font-family:'Courier New'">let _linker = this.getLinker();</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:50.4pt; font-size:10.5pt"><span style="font-family:'Courier New'">document.querySelectorAll("iframe").forEach((e) =&gt; {</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:75.6pt; font-size:10.5pt"><span style="font-family:'Courier New'">if (!_linker || e != _linker.target) e.remove()</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:50.4pt; font-size:10.5pt"><span style="font-family:'Courier New'">})</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:50.4pt; font-size:10.5pt"><span style="font-family:'Courier New'">if (_world.reset) return</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:50.4pt; font-size:10.5pt"><span style="font-family:'Courier New'">_linker.target.setAttribute("name", "dive1");</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:50.4pt; font-size:10.5pt"><span style="font-family:'Courier New'">_linker.target.classList.remove("preload");</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:50.4pt; font-size:10.5pt"><span style="font-family:'Courier New'">_linker.enableBlock(false);</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:25.2pt; font-size:10.5pt"><span style="font-family:'Courier New'">}</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:25.2pt; font-size:10.5pt"><span style="font-family:'Courier New'">get_world_outputs() {</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:50.4pt; font-size:10.5pt"><span style="font-family:'Courier New'">return this.outputList</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:25.2pt; font-size:10.5pt"><span style="font-family:'Courier New'">}</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:25.2pt; font-size:10.5pt"><span style="font-family:'Courier New'">get_world_output(name) {</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:50.4pt; font-size:10.5pt"><span style="font-family:'Courier New'">return this.outputList[name].value</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:25.2pt; font-size:10.5pt"><span style="font-family:'Courier New'">}</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:25.2pt; font-size:10.5pt"><span style="font-family:'Courier New'">setInput() {</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:50.4pt; font-size:10.5pt"><span style="font-family:'Courier New'">return new Promise((resolve, reject) =&gt; {</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:75.6pt; font-size:10.5pt"><span style="font-family:'Courier New'">if (this.isInitial) return resolve()</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:75.6pt; font-size:10.5pt"><span style="font-family:'Courier New'">let _world = this;</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:75.6pt; font-size:10.5pt"><span style="font-family:'Courier New'">let linker = this.getLinker();</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:75.6pt; font-size:10.5pt"><span style="font-family:'Courier New'">_world.checkTimer("input_timer");</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:75.6pt; font-size:10.5pt"><span style="font-family:'Courier New'">_world.input_timer = setInterval(() =&gt; {</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:100.8pt; font-size:10.5pt"><span style="font-family:'Courier New'">if (!linker.initial) return</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:100.8pt; font-size:10.5pt"><span style="font-family:'Courier New'">clearInterval(_world.input_timer);</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:100.8pt; font-size:10.5pt"><span style="font-family:'Courier New'">delete _world.input_timer;</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:100.8pt; font-size:10.5pt"><span style="font-family:'Courier New'">let inputs = linker.getInputList();</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:100.8pt; font-size:10.5pt"><span style="font-family:'Courier New'">let outputList = this.get_world_outputs();</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:100.8pt; font-size:10.5pt"><span style="font-family:'Courier New'">let inputArray = [];</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:100.8pt; font-size:10.5pt"><span style="font-family:'Courier New'">for (const key in inputs) {</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:126pt; font-size:10.5pt"><span style="font-family:'Courier New'">if (inputs.hasOwnProperty(key)) {</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:151.2pt; font-size:10.5pt"><span style="font-family:'Courier New'">const input = inputs[key];</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:151.2pt; font-size:10.5pt"><span style="font-family:'Courier New'">if (outputNames.indexOf(input.name) == -1) continue</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:151.2pt; font-size:10.5pt"><span style="font-family:'Courier New'">let cache_output = outputList[input.name];</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:151.2pt; font-size:10.5pt"><span style="font-family:'Courier New'">let obj = {</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:176.45pt; font-size:10.5pt"><span style="font-family:'Courier New'">id: input.id,</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:176.45pt; font-size:10.5pt"><span style="font-family:'Courier New'">value: cache_output.value</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:151.2pt; font-size:10.5pt"><span style="font-family:'Courier New'">}</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:151.2pt; font-size:10.5pt"><span style="font-family:'Courier New'">inputArray.push(obj);</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:126pt; font-size:10.5pt"><span style="font-family:'Courier New'">}</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:100.8pt; font-size:10.5pt"><span style="font-family:'Courier New'">}</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:100.8pt; font-size:10.5pt"><span style="font-family:'Courier New'">linker.setInput(inputArray);</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:100.8pt; font-size:10.5pt"><span style="font-family:'Courier New'">resolve();</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:75.6pt; font-size:10.5pt"><span style="font-family:'Courier New'">}, 100);</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:50.4pt; font-size:10.5pt"><span style="font-family:'Courier New'">});</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:25.2pt; font-size:10.5pt"><span style="font-family:'Courier New'">}</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:25.2pt; font-size:10.5pt"><span style="font-family:'Courier New'">isEmpty(obj) {</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:50.4pt; font-size:10.5pt"><span style="font-family:'Courier New'">for (var key in obj) {</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:75.6pt; font-size:10.5pt"><span style="font-family:'Courier New'">if (obj.hasOwnProperty(key))</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:100.8pt; font-size:10.5pt"><span style="font-family:'Courier New'">return false;</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:50.4pt; font-size:10.5pt"><span style="font-family:'Courier New'">}</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:50.4pt; font-size:10.5pt"><span style="font-family:'Courier New'">return true;</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:25.2pt; font-size:10.5pt"><span style="font-family:'Courier New'">}</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:25.2pt; font-size:10.5pt"><span style="font-family:'Courier New'">/**</span></p><p style="margin-top:0pt; margin-left:50.4pt; margin-bottom:0pt; text-indent:-18.9pt; font-size:10.5pt"><span style="font-family:'Courier New'">*</span><span style="font:7pt 'Times New Roman'">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span style="font-family:'Courier New'">default is loading</span></p><p style="margin-top:0pt; margin-left:50.4pt; margin-bottom:0pt; text-indent:-18.9pt; font-size:10.5pt"><span style="font-family:'Courier New'">*</span><span style="font:7pt 'Times New Roman'">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span style="font-family:'Courier New'">@param {HTMLElement} node</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:31.5pt; font-size:10.5pt"><span style="font-family:'Courier New'">*/</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:25.2pt; font-size:10.5pt"><span style="font-family:'Courier New'">hide(node) {</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:50.4pt; font-size:10.5pt"><span style="font-family:'Courier New'">if (!node) return this.loading.classList.add("dive-hide")</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:50.4pt; font-size:10.5pt"><span style="font-family:'Courier New'">node.classList.add("dive-hide")</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:25.2pt; font-size:10.5pt"><span style="font-family:'Courier New'">}</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:25.2pt; font-size:10.5pt"><span style="font-family:'Courier New'">focusDIVE() {</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:50.4pt; font-size:10.5pt"><span style="font-family:'Courier New'">try {</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:75.6pt; font-size:10.5pt"><span style="font-family:'Courier New'">let dom = document.querySelector("iframe[name=dive1");</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:75.6pt; font-size:10.5pt"><span style="font-family:'Courier New'">dom.contentWindow.focus();</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:50.4pt; font-size:10.5pt"><span style="font-family:'Courier New'">} catch (err) {</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:75.6pt; font-size:10.5pt"><span style="font-family:'Courier New'">console.error('Error: Focus DIVE failed!', err);</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:50.4pt; font-size:10.5pt"><span style="font-family:'Courier New'">}</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:25.2pt; font-size:10.5pt"><span style="font-family:'Courier New'">}</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:25.2pt; font-size:10.5pt"><span style="font-family:'Courier New'">/**</span></p><p style="margin-top:0pt; margin-left:50.4pt; margin-bottom:0pt; text-indent:-18.9pt; font-size:10.5pt"><span style="font-family:'Courier New'">*</span><span style="font:7pt 'Times New Roman'">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span style="font-family:'Courier New'">default is loading</span></p><p style="margin-top:0pt; margin-left:50.4pt; margin-bottom:0pt; text-indent:-18.9pt; font-size:10.5pt"><span style="font-family:'Courier New'">*</span><span style="font:7pt 'Times New Roman'">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span style="font-family:'Courier New'">@param {HTMLElement} node</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:31.5pt; font-size:10.5pt"><span style="font-family:'Courier New'">*/</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:25.2pt; font-size:10.5pt"><span style="font-family:'Courier New'">show(node) {</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:50.4pt; font-size:10.5pt"><span style="font-family:'Courier New'">if (!node) return this.loading.classList.remove("dive-hide")</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:50.4pt; font-size:10.5pt"><span style="font-family:'Courier New'">node.classList.remove("dive-hide")</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:25.2pt; font-size:10.5pt"><span style="font-family:'Courier New'">}</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:25.2pt; font-size:10.5pt"><span style="font-family:'Courier New'">showNext() {</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:50.4pt; font-size:10.5pt"><span style="font-family:'Courier New'">return new Promise((resolve, reject) =&gt; {</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:75.6pt; font-size:10.5pt"><span style="font-family:'Courier New'">let dom = document.querySelector("iframe[name=dive1");</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:75.6pt; font-size:10.5pt"><span style="font-family:'Courier New'">dom.classList.remove("dive-hide");</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:75.6pt; font-size:10.5pt"><span style="font-family:'Courier New'">this.focusDIVE();</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:75.6pt; font-size:10.5pt"><span style="font-family:'Courier New'">resolve();</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:50.4pt; font-size:10.5pt"><span style="font-family:'Courier New'">});</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:25.2pt; font-size:10.5pt"><span style="font-family:'Courier New'">}</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:25.2pt; font-size:10.5pt"><span style="font-family:'Courier New'">fullScreen() {</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:50.4pt; font-size:10.5pt"><span style="font-family:'Courier New'">if (document.fullscreenEnabled ||</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:75.6pt; font-size:10.5pt"><span style="font-family:'Courier New'">document.webkitFullscreenEnabled ||</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:75.6pt; font-size:10.5pt"><span style="font-family:'Courier New'">document.mozFullScreenEnabled ||</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:75.6pt; font-size:10.5pt"><span style="font-family:'Courier New'">document.msFullscreenEnabled) {</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:75.6pt; font-size:10.5pt"><span style="font-family:'Courier New'">// Do fullscreen</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:75.6pt; font-size:10.5pt"><span style="font-family:'Courier New'">if (this.app.requestFullscreen) {</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:100.8pt; font-size:10.5pt"><span style="font-family:'Courier New'">this.app.requestFullscreen();</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:75.6pt; font-size:10.5pt"><span style="font-family:'Courier New'">} else if (this.app.webkitRequestFullscreen) {</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:100.8pt; font-size:10.5pt"><span style="font-family:'Courier New'">this.app.webkitRequestFullscreen();</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:75.6pt; font-size:10.5pt"><span style="font-family:'Courier New'">} else if (this.app.mozRequestFullScreen) {</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:100.8pt; font-size:10.5pt"><span style="font-family:'Courier New'">this.app.mozRequestFullScreen();</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:75.6pt; font-size:10.5pt"><span style="font-family:'Courier New'">} else if (this.app.msRequestFullscreen) {</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:100.8pt; font-size:10.5pt"><span style="font-family:'Courier New'">this.app.msRequestFullscreen();</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:75.6pt; font-size:10.5pt"><span style="font-family:'Courier New'">}</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:50.4pt; font-size:10.5pt"><span style="font-family:'Courier New'">}</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:25.2pt; font-size:10.5pt"><span style="font-family:'Courier New'">}</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:25.2pt; font-size:10.5pt"><span style="font-family:'Courier New'">mobilecheck() {</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:50.4pt; font-size:10.5pt"><span style="font-family:'Courier New'">let check = false;</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:50.4pt; font-size:10.5pt"><span style="font-family:'Courier New'">(function (a) {</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:75.6pt; font-size:10.5pt"><span style="font-family:'Courier New'">if (</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:100.8pt; font-size:10.5pt"><span style="font-family:'Courier New'">/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:100.8pt; font-size:10.5pt"><span style="font-family:'Courier New'">.test(a) ||</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:100.8pt; font-size:10.5pt"><span style="font-family:'Courier New'">/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:100.8pt; font-size:10.5pt"><span style="font-family:'Courier New'">.test(a.substr(0, 4))) check = true;</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:50.4pt; font-size:10.5pt"><span style="font-family:'Courier New'">})(navigator.userAgent || navigator.vendor || window.opera);</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:50.4pt; font-size:10.5pt"><span style="font-family:'Courier New'">return check;</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:25.2pt; font-size:10.5pt"><span style="font-family:'Courier New'">};</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:25.2pt; font-size:10.5pt"><span style="font-family:'Courier New'">/**</span></p><p style="margin-top:0pt; margin-left:50.4pt; margin-bottom:0pt; text-indent:-18.9pt; font-size:10.5pt"><span style="font-family:'Courier New'">*</span><span style="font:7pt 'Times New Roman'">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span style="font-family:'Courier New'">shakeHand with diveServer</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:31.5pt; font-size:10.5pt"><span style="font-family:'Courier New'">*/</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:25.2pt; font-size:10.5pt"><span style="font-family:'Courier New'">getID() {</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:50.4pt; font-size:10.5pt"><span style="font-family:'Courier New'">const soup_ = '!#%()*+,-./:;=?@[]^_`{|}~' +</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:75.6pt; font-size:10.5pt"><span style="font-family:'Courier New'">'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:50.4pt; font-size:10.5pt"><span style="font-family:'Courier New'">const length = 20;</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:50.4pt; font-size:10.5pt"><span style="font-family:'Courier New'">const soupLength = soup_.length;</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:50.4pt; font-size:10.5pt"><span style="font-family:'Courier New'">const id = [];</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:50.4pt; font-size:10.5pt"><span style="font-family:'Courier New'">for (let i = 0; i &lt; length; i++) {</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:75.6pt; font-size:10.5pt"><span style="font-family:'Courier New'">id[i] = soup_.charAt(Math.random() * soupLength);</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:50.4pt; font-size:10.5pt"><span style="font-family:'Courier New'">}</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:50.4pt; font-size:10.5pt"><span style="font-family:'Courier New'">return id.join('');</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:25.2pt; font-size:10.5pt"><span style="font-family:'Courier New'">}</span></p><p style="margin-top:0pt; margin-bottom:0pt; font-size:10.5pt"><span style="font-family:'Courier New'">}</span></p><p style="margin-top:0pt; margin-bottom:0pt; font-size:10.5pt"><span style="font-family:'Courier New'">/***************************************** </span><span style="font-family:'Microsoft JhengHei'">以下為自訂參數</span><span style="font-family:'Courier New'">*****************************************/</span></p><p style="margin-top:0pt; margin-bottom:0pt; font-size:10.5pt"><span style="font-family:'Courier New'">/**</span></p><p style="margin-top:0pt; margin-left:25.2pt; margin-bottom:0pt; text-indent:-18.9pt; font-size:10.5pt"><span style="font-family:'Courier New'">*</span><span style="font:7pt 'Times New Roman'">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span style="font-family:'Microsoft JhengHei'">要傳遞的輸出屬性名稱</span><span style="font-family:'Courier New'">，</span><span style="font-family:'Microsoft JhengHei'">請確保每個屬性在各實驗中都設定好</span><span style="font-family:'Courier New'">I/O</span><span style="font-family:'Microsoft JhengHei'">並名稱一致</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:6.3pt; font-size:10.5pt"><span style="font-family:'Courier New'">*/</span></p><p style="margin-top:0pt; margin-bottom:0pt; font-size:10.5pt"><span style="font-family:'Courier New'">const outputNames = [</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:25.2pt; font-size:10.5pt"><span style="font-family:'Courier New'">"map[from]"</span></p><p style="margin-top:0pt; margin-bottom:0pt; font-size:10.5pt"><span style="font-family:'Courier New'">];</span></p><p style="margin-top:0pt; margin-bottom:0pt; font-size:10.5pt"><span style="font-family:'Courier New'">/**</span></p><p style="margin-top:0pt; margin-left:25.2pt; margin-bottom:0pt; text-indent:-18.9pt; font-size:10.5pt"><span style="font-family:'Courier New'">*</span><span style="font:7pt 'Times New Roman'">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span style="font-family:'Microsoft JhengHei'">切換時</span><span style="font-family:'Courier New'">[</span><span style="font-family:'Microsoft JhengHei'">範例中進入傳送點時</span><span style="font-family:'Courier New'">]</span><span style="font-family:'Microsoft JhengHei'">回傳的地圖</span><span style="font-family:'Courier New'">[</span><span style="font-family:'Microsoft JhengHei'">列</span><span style="font-family:'Courier New'">]</span></p><p style="margin-top:0pt; margin-left:25.2pt; margin-bottom:0pt; text-indent:-18.9pt; font-size:10.5pt"><span style="font-family:'Courier New'">*</span><span style="font:7pt 'Times New Roman'">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span style="font-family:'Microsoft JhengHei'">切換時</span><span style="font-family:'Courier New'">[</span><span style="font-family:'Microsoft JhengHei'">範例中進入傳送點時</span><span style="font-family:'Courier New'">]</span><span style="font-family:'Microsoft JhengHei'">回傳的地圖</span><span style="font-family:'Courier New'">[</span><span style="font-family:'Microsoft JhengHei'">行</span><span style="font-family:'Courier New'">]</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:6.3pt; font-size:10.5pt"><span style="font-family:'Courier New'">*/</span></p><p style="margin-top:0pt; margin-bottom:0pt; font-size:10.5pt"><span style="font-family:'Courier New'">const row = "row[output]";</span></p><p style="margin-top:0pt; margin-bottom:0pt; font-size:10.5pt"><span style="font-family:'Courier New'">const col = "col[output]";</span></p><p style="margin-top:0pt; margin-bottom:0pt; font-size:10.5pt"><span style="font-family:'Courier New'">/***************************</span><span style="font-family:'Microsoft JhengHei'">以上是</span><span style="font-family:'Courier New'">I/O</span><span style="font-family:'Microsoft JhengHei'">屬性設定</span><span style="font-family:'Courier New'">***************************/</span></p><p style="margin-top:0pt; margin-bottom:0pt; font-size:10.5pt"><span style="font-family:'Courier New'">&#xa0;</span></p><p style="margin-top:0pt; margin-bottom:0pt; font-size:10.5pt"><span style="font-family:'Courier New'">/***************************</span><span style="font-family:'Microsoft JhengHei'">以下是地圖</span><span style="font-family:'Courier New'">&amp;</span><span style="font-family:'Microsoft JhengHei'">地圖參數設定</span><span style="font-family:'Courier New'">***************************/</span></p><p style="margin-top:0pt; margin-bottom:0pt; font-size:10.5pt"><span style="font-family:'Courier New'">const map_col = 2; //</span><span style="font-family:'Microsoft JhengHei'">地圖行</span></p><p style="margin-top:0pt; margin-bottom:0pt; font-size:10.5pt"><span style="font-family:'Courier New'">const map_row = 2; //</span><span style="font-family:'Microsoft JhengHei'">地圖列</span></p><p style="margin-top:0pt; margin-bottom:0pt; font-size:10.5pt"><span style="font-family:'Courier New'">const map = [</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:25.2pt; font-size:10.5pt"><span style="font-family:'Courier New'">32576, 32510,</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:25.2pt; font-size:10.5pt"><span style="font-family:'Courier New'">32535, 32426</span></p><p style="margin-top:0pt; margin-bottom:0pt; font-size:10.5pt"><span style="font-family:'Courier New'">];</span></p><p style="margin-top:0pt; margin-bottom:0pt; font-size:10.5pt"><span style="font-family:'Courier New'">/**</span></p><p style="margin-top:0pt; margin-left:25.2pt; margin-bottom:0pt; text-indent:-18.9pt; font-size:10.5pt"><span style="font-family:'Courier New'">*</span><span style="font:7pt 'Times New Roman'">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span style="font-family:'MS Gothic'">「</span><span style="font-family:'Microsoft JhengHei'">指定預載</span><span style="font-family:'MS Gothic'">」</span></p><p style="margin-top:0pt; margin-left:25.2pt; margin-bottom:0pt; text-indent:-18.9pt; font-size:10.5pt"><span style="font-family:'Courier New'">*</span><span style="font:7pt 'Times New Roman'">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span style="font-family:'Microsoft JhengHei'">可設定專案要預載的專案集合</span><span style="font-family:'Courier New'">，</span><span style="font-family:'Microsoft JhengHei'">未指定時採用</span><span style="font-family:'MS Gothic'">「</span><span style="font-family:'Microsoft JhengHei'">預設預載</span><span style="font-family:'MS Gothic'">」。</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:6.3pt; font-size:10.5pt"><span style="font-family:'Courier New'">*/</span></p><p style="margin-top:0pt; margin-bottom:0pt; font-size:10.5pt"><span style="font-family:'Courier New'">const preload_json = {</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:25.2pt; font-size:10.5pt"><span style="font-family:'Courier New'">32576: [32510, 32535, 32426],</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:25.2pt; font-size:10.5pt"><span style="font-family:'Courier New'">32510: [32576, 32535, 32426],</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:25.2pt; font-size:10.5pt"><span style="font-family:'Courier New'">32535: [32576, 32510, 32426],</span></p><p style="margin-top:0pt; margin-bottom:0pt; text-indent:25.2pt; font-size:10.5pt"><span style="font-family:'Courier New'">32426: [32576, 32510, 32535]</span></p><p style="margin-top:0pt; margin-bottom:0pt; font-size:10.5pt"><span style="font-family:'Courier New'">}</span></p><p style="margin-top:0pt; margin-bottom:0pt; font-size:10.5pt"><span style="font-family:'Courier New'">/***************************</span><span style="font-family:'Microsoft JhengHei'">以上為自訂參數</span><span style="font-family:'Courier New'">***************************/</span></p><p style="margin-top:0pt; margin-bottom:0pt; font-size:10.5pt"><span style="font-family:'Courier New'">&#xa0;</span></p><p style="margin-top:0pt; margin-bottom:0pt; font-size:10.5pt"><span style="font-family:'Courier New'">//put global. easy to check.</span></p><p style="margin-top:0pt; margin-bottom:0pt; font-size:10.5pt"><span style="font-family:'Courier New'">/***********************Code start************************************/</span></p><p style="margin-top:0pt; margin-bottom:0pt; font-size:10.5pt"><span style="font-family:'Courier New'">const diveWorld = new DiveWorld(map, preload_json);</span></p><p style="margin-top:0pt; margin-bottom:0pt; font-size:10.5pt"><span style="font-family:'Courier New'">&#xa0;</span></p></div></body></html>